{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% extends "base.njk" %}

{% set shareYourDetails = [] %}

{% if formData and formData.shareYourDetails %}
  {% if formData.shareYourDetails is iterable %}
    {% set shareYourDetails = formData.shareYourDetails %}
  {% else %}
    {% set shareYourDetails = [formData.shareYourDetails] %}
  {% endif %}
{% endif %}

{% set addNameAndEmailToComponentPageChecked = "addNameAndEmailToComponentPage" in shareYourDetails %}
{% set onlyShareNameAndEmailWhenRequestedChecked = "onlyShareNameAndEmailWhenRequested" in shareYourDetails %}
{% set doNotSharePersonalDetailsChecked = "doNotSharePersonalDetails" in shareYourDetails %}

{% block content %}

  {% if backLink %}
    <div class="app-layout__backlink">
      {{ govukBackLink({
        text: "Back",
        href: backLink
      }) }}
    </div>
  {% endif %}
  <div class="app-layout__content">
  {% if errorList %}
    {{ govukErrorSummary({
      titleText: "There is a problem",
      errorList: errorList
    }) }}
  {% endif %}
  <form method="post" action="{{ submitUrl }}">
      <span class="govuk-caption-l">Submit new component</span>
      <h1>Your details</h1>
      <p>Providing your personal information means the team can contact you to discuss the component further, if required. The team will also let you when the component goes live in the design system.</p>
      <p>With your permission, your name and email address will be added to the component page to show you added it to the design system.</p>
      {{ govukInput({
            label: {
                text: "Full name",
                classes: "govuk-label--m",
                isPageHeading: true
            },
            id: "full-name",
            name: "fullName",
        errorMessage: formErrors.fullName,
        value: formData.fullName
        }) }}

        {{ govukInput({
            label: {
                text: "Email address",
                classes: "govuk-label--m",
                isPageHeading: true
            },
            id: "email-address",
            name: "emailAddress",
          errorMessage: formErrors.emailAddress,
          value: formData.emailAddress
        }) }}

      {{ govukCheckboxes({
        name: "shareYourDetails",
        id: 'share-your-details',
        fieldset: {
          legend: {
            text: "Select how you allow us to share your personal details",
            isPageHeading: true,
            classes: "govuk-fieldset__legend--m"
          }
        },
        hint: {
          text: "Select all that apply"
        },
        items: [
          {
            value: "addNameAndEmailToComponentPage",
            text: "Add my name and email address to the component page",
            checked: addNameAndEmailToComponentPageChecked
          },
          {
            value: "onlyShareNameAndEmailWhenRequested",
            text: "Only share my name and email address when requested by other users",
            checked: onlyShareNameAndEmailWhenRequestedChecked
          },
          {
            divider: "or"
          },
          {
            value: "doNotSharePersonalDetails",
            text: "Do not share my personal details with anyone",
            checked: doNotSharePersonalDetailsChecked
          }
        ],
        errorMessage: formErrors.shareYourDetails,
        value: formData.shareYourDetails
      }) }}

      <div class="govuk-inset-text">
        If you do not allow us to share your personal information, this may not represent a 'community component'. This prevents us, and others, getting in touch with you. Meaning it may stop the continuing collaboration of the component.
      </div>

        <div class="moj-button-action">
            {{ govukButton({
                text: 'Continue'
            }) }}
        </div>
    </form>
</div>
{% endblock %}
